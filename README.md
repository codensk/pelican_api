# 🪶 Pelican API Backend

> Backend-сервис **Pelican**.  

---

## 📑 Содержание

- [📦 Требования](#-требования)
- [⚙️ Развертывание](#️-развертывание)
    - [1. Клонирование репозитория](#1-клонирование-репозитория)
    - [2. Установка зависимостей](#2-установка-зависимостей)
    - [3. Настройка окружения](#3-настройка-окружения)
    - [4. Настройка планировщика](#4-настройка-планировщика)
- [🧩 Подготовка Booking](#-подготовка-booking)
- [🪶 Подготовка Pelican](#-подготовка-pelican)
- [🏢 Подключение юр лиц](#-подключение-юр-лиц)
- [🗃️ Инициализация базы данных](#️-инициализация-базы-данных)

---

## 📦 Требования

Перед запуском убедитесь, что установлены:

| Компонент | Версия |
|------------|---------|
| PHP | **>= 8.2** |
| Composer | **>= 2.5** |
| Laravel | **12.x** |
| MySQL / PostgreSQL | — |
| PHP extensions | `mbstring`, `openssl`, `pdo`, `bcmath`, `json`, `curl` |

---

## ⚙️ Развертывание

### 1. Клонирование репозитория

```bash
git clone https://github.com/codensk/pelican_api.git
cd pelican-backend
```

### 2. Установка зависимостей

```bash
composer install
```

### 3. Настройка окружения

Создайте файл окружения:

```bash
cp .env.example .env
php artisan key:generate
```

### 4. Настройка планировщика

Запустите планировщика:

```bash
php artisan schedule:run
```

Можно добавить Cron-задание. Пример:

```bash
* * * * * cd /var/www/api_pelican__usr/data/www/api.pelican.online && /opt/php84/bin/php artisan schedule:run >> /dev/null 2>&1
```

---

## 🧩 Подготовка Booking

1. Создать **клиента для физ. лиц**
2. Создать **договор** и **прайс**
3. В договоре установить галочку → ✅ `Основной для Pelican`
4. На вкладке **«Настройки»** сгенерировать **API-токен**

---

## 🪶 Подготовка Pelican

1. В конфиге **Pelican**:
    - Прописать **API-токен** и **ID договора**
    - Сменить эндпоинты на боевые:

      ```
      https://booking.busfer.com
      ```

---

## 🏢 Подключение юр. лиц к Pelican

1. В договоре установить галочку → ✅ `Основной для Pelican`
2. На вкладке **«Настройки»** — сгенерировать **API-токен**
3. На вкладке **«Pelican»** → создать **новую учётную запись**

> ⚠️ На указанный E-mail будет отправлен логин и пароль для входа в личный кабинет Pelican.

---

## 🗃️ Инициализация базы данных

Запустите миграции и сидеры:

```bash
php artisan migrate
php artisan db:seed
```

> 💡 Для пересоздания базы:
> ```bash
> php artisan migrate:fresh --seed
> ```
